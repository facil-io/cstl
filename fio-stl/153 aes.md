## AES-GCM

```c
#define FIO_AES
#include "fio-stl/include.h"
```

AES-GCM provides authenticated encryption with associated data (AEAD). This is the most common cipher suite for TLS 1.3 and is widely used in secure communications.

The implementation automatically uses hardware acceleration when available:
- **x86/x64**: AES-NI and PCLMULQDQ instructions
- **ARM**: Crypto Extensions (PMULL)
- **Fallback**: Portable software implementation using T-tables

**Note:** the API matches `fio_chacha20_poly1305` for easy function pointer substitution, allowing applications to switch between cipher suites without code changes.

**Note:** this module depends on the `FIO_MATH` module which will be automatically included.

### AES-128-GCM

#### `fio_aes128_gcm_enc`

```c
void fio_aes128_gcm_enc(void *restrict mac,
                        void *restrict data,
                        size_t len,
                        const void *ad,
                        size_t adlen,
                        const void *key,
                        const void *nonce);
```

Performs an in-place encryption of `data` using AES-128-GCM with additional data, producing a 16 byte message authentication code (MAC).

* `mac`    MUST point to a buffer with (at least) 16 available bytes.
* `key`    MUST point to a 128 bit long memory address (16 Bytes).
* `nonce`  MUST point to a  96 bit long memory address (12 Bytes).
* `ad`     MAY be omitted, will NOT be encrypted.
* `data`   MAY be omitted, WILL be encrypted.

**Note:** the nonce MUST be unique for each message encrypted with the same key. Reusing a nonce with the same key completely breaks the security of GCM.

#### `fio_aes128_gcm_dec`

```c
int fio_aes128_gcm_dec(void *restrict mac,
                       void *restrict data,
                       size_t len,
                       const void *ad,
                       size_t adlen,
                       const void *key,
                       const void *nonce);
```

Performs an in-place decryption of `data` using AES-128-GCM after authenticating the message authentication code (MAC).

* `mac`    MUST point to a buffer with the 16 byte MAC to verify.
* `key`    MUST point to a 128 bit long memory address (16 Bytes).
* `nonce`  MUST point to a  96 bit long memory address (12 Bytes).
* `ad`     MAY be omitted ONLY IF originally omitted.
* `data`   MAY be omitted, WILL be decrypted.

Returns `-1` on error (authentication failed). When authentication fails, the data buffer is NOT modified.

### AES-256-GCM

#### `fio_aes256_gcm_enc`

```c
void fio_aes256_gcm_enc(void *restrict mac,
                        void *restrict data,
                        size_t len,
                        const void *ad,
                        size_t adlen,
                        const void *key,
                        const void *nonce);
```

Performs an in-place encryption of `data` using AES-256-GCM with additional data, producing a 16 byte message authentication code (MAC).

* `mac`    MUST point to a buffer with (at least) 16 available bytes.
* `key`    MUST point to a 256 bit long memory address (32 Bytes).
* `nonce`  MUST point to a  96 bit long memory address (12 Bytes).
* `ad`     MAY be omitted, will NOT be encrypted.
* `data`   MAY be omitted, WILL be encrypted.

**Note:** the nonce MUST be unique for each message encrypted with the same key. Reusing a nonce with the same key completely breaks the security of GCM.

#### `fio_aes256_gcm_dec`

```c
int fio_aes256_gcm_dec(void *restrict mac,
                       void *restrict data,
                       size_t len,
                       const void *ad,
                       size_t adlen,
                       const void *key,
                       const void *nonce);
```

Performs an in-place decryption of `data` using AES-256-GCM after authenticating the message authentication code (MAC).

* `mac`    MUST point to a buffer with the 16 byte MAC to verify.
* `key`    MUST point to a 256 bit long memory address (32 Bytes).
* `nonce`  MUST point to a  96 bit long memory address (12 Bytes).
* `ad`     MAY be omitted ONLY IF originally omitted.
* `data`   MAY be omitted, WILL be decrypted.

Returns `-1` on error (authentication failed). When authentication fails, the data buffer is NOT modified.

### Security Considerations

**Nonce Uniqueness:** GCM mode requires that each (key, nonce) pair is used only once. Reusing a nonce with the same key allows an attacker to recover the authentication key and forge messages. For random nonces with a 96-bit nonce space, the probability of collision becomes significant after approximately 2^32 messages.

**Key Sizes:** AES-256-GCM provides a higher security margin than AES-128-GCM. While both are considered secure, AES-256 is recommended for long-term security and compliance with stricter security requirements.

**TLS 1.3 Compatibility:** Both AES-128-GCM and AES-256-GCM are mandatory cipher suites in TLS 1.3 (`TLS_AES_128_GCM_SHA256` and `TLS_AES_256_GCM_SHA384`).

------------------------------------------------------------
