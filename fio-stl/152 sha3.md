## SHA-3

```c
#define FIO_SHA3
#include FIO_INCLUDE_FILE
```

By defining `FIO_SHA3`, the SHA-3 cryptographic hash functions and SHAKE extendable-output functions are defined and made available.

This module provides the full SHA-3 family standardized in [FIPS 202](https://csrc.nist.gov/publications/detail/fips/202/final):

- **SHA3-224** - 28-byte (224-bit) fixed-output hash
- **SHA3-256** - 32-byte (256-bit) fixed-output hash
- **SHA3-384** - 48-byte (384-bit) fixed-output hash
- **SHA3-512** - 64-byte (512-bit) fixed-output hash
- **SHAKE128** - extendable-output function with 128-bit security
- **SHAKE256** - extendable-output function with 256-bit security

All variants share a single streaming type (`fio_sha3_s`) and support both one-shot and streaming (init/consume/finalize) usage patterns.

### SHA-3 Types

#### `fio_sha3_s`

```c
typedef struct {
  uint64_t state[25]; /* Keccak state (1600 bits) */
  uint8_t buf[200];   /* rate buffer (max rate = 1600 - 2*capacity) */
  size_t buflen;      /* bytes in buffer */
  size_t rate;        /* rate in bytes */
  size_t outlen;      /* output length in bytes (0 for SHAKE) */
  uint8_t delim;      /* domain separation byte */
} fio_sha3_s;
```

Streaming context for all SHA-3 and SHAKE variants. The Keccak state is 1600 bits (25 x 64-bit words).

**Members:**
- `state` - the 25-word Keccak-f[1600] state
- `buf` - input buffer for partial blocks (up to `rate` bytes)
- `buflen` - number of bytes currently in the buffer
- `rate` - rate in bytes, determined by the variant (e.g., 136 for SHA3-256)
- `outlen` - fixed output length in bytes (0 for SHAKE variants)
- `delim` - domain separation byte (0x06 for SHA-3, 0x1F for SHAKE)

**Note**: this type should be treated as opaque. Use the appropriate init function to initialize it.

### SHA-3 Fixed-Output Functions

#### `fio_sha3_224`

```c
void fio_sha3_224(void *restrict out,
                  const void *restrict data,
                  size_t len);
```

One-shot SHA3-224 hash producing a 28-byte digest.

**Parameters:**
- `out` - destination buffer (must have capacity for at least 28 bytes)
- `data` - pointer to the data to hash
- `len` - length of the data in bytes

#### `fio_sha3_256`

```c
void fio_sha3_256(void *restrict out,
                  const void *restrict data,
                  size_t len);
```

One-shot SHA3-256 hash producing a 32-byte digest.

**Parameters:**
- `out` - destination buffer (must have capacity for at least 32 bytes)
- `data` - pointer to the data to hash
- `len` - length of the data in bytes

#### `fio_sha3_384`

```c
void fio_sha3_384(void *restrict out,
                  const void *restrict data,
                  size_t len);
```

One-shot SHA3-384 hash producing a 48-byte digest.

**Parameters:**
- `out` - destination buffer (must have capacity for at least 48 bytes)
- `data` - pointer to the data to hash
- `len` - length of the data in bytes

#### `fio_sha3_512`

```c
void fio_sha3_512(void *restrict out,
                  const void *restrict data,
                  size_t len);
```

One-shot SHA3-512 hash producing a 64-byte digest.

**Parameters:**
- `out` - destination buffer (must have capacity for at least 64 bytes)
- `data` - pointer to the data to hash
- `len` - length of the data in bytes

### SHA-3 Streaming API

#### `fio_sha3_224_init`

```c
fio_sha3_s fio_sha3_224_init(void);
```

Initializes a SHA3-224 streaming context (28-byte output, rate = 144 bytes).

**Returns:** an initialized `fio_sha3_s` context.

#### `fio_sha3_256_init`

```c
fio_sha3_s fio_sha3_256_init(void);
```

Initializes a SHA3-256 streaming context (32-byte output, rate = 136 bytes).

**Returns:** an initialized `fio_sha3_s` context.

#### `fio_sha3_384_init`

```c
fio_sha3_s fio_sha3_384_init(void);
```

Initializes a SHA3-384 streaming context (48-byte output, rate = 104 bytes).

**Returns:** an initialized `fio_sha3_s` context.

#### `fio_sha3_512_init`

```c
fio_sha3_s fio_sha3_512_init(void);
```

Initializes a SHA3-512 streaming context (64-byte output, rate = 72 bytes).

**Returns:** an initialized `fio_sha3_s` context.

#### `fio_sha3_consume`

```c
void fio_sha3_consume(fio_sha3_s *restrict h,
                      const void *restrict data,
                      size_t len);
```

Feeds data into a SHA-3 streaming context.

Can be called multiple times to incrementally hash data. Full blocks are absorbed directly from the input pointer (avoiding an extra copy), while partial blocks are buffered internally.

**Parameters:**
- `h` - pointer to an initialized `fio_sha3_s` context
- `data` - pointer to the data to consume
- `len` - length of the data in bytes

**Note**: this function is also used for SHAKE via the `fio_shake_consume` alias.

#### `fio_sha3_finalize`

```c
void fio_sha3_finalize(fio_sha3_s *restrict h, void *restrict out);
```

Finalizes a SHA-3 streaming context and writes the digest to `out`.

Applies SHA-3 padding (domain separator 0x06, then 10*1 padding), performs the final Keccak-f[1600] permutation, and squeezes the output.

**Parameters:**
- `h` - pointer to the streaming context to finalize
- `out` - destination buffer (must have capacity for at least `h->outlen` bytes)

**Note**: the context should not be used after finalization. Do **not** use this function for SHAKE â€” use `fio_shake_squeeze` instead.

### SHAKE Extendable-Output Functions

SHAKE (Secure Hash Algorithm KECCAK) provides extendable-output: you can request any number of output bytes. SHAKE128 provides 128-bit security and SHAKE256 provides 256-bit security.

#### `fio_shake128`

```c
void fio_shake128(void *restrict out,
                  size_t outlen,
                  const void *restrict data,
                  size_t len);
```

One-shot SHAKE128 with specified output length.

**Parameters:**
- `out` - destination buffer (must have capacity for at least `outlen` bytes)
- `outlen` - desired output length in bytes (can be any value)
- `data` - pointer to the data to hash
- `len` - length of the data in bytes

#### `fio_shake256`

```c
void fio_shake256(void *restrict out,
                  size_t outlen,
                  const void *restrict data,
                  size_t len);
```

One-shot SHAKE256 with specified output length.

**Parameters:**
- `out` - destination buffer (must have capacity for at least `outlen` bytes)
- `outlen` - desired output length in bytes (can be any value)
- `data` - pointer to the data to hash
- `len` - length of the data in bytes

### SHAKE Streaming API

#### `fio_shake128_init`

```c
fio_sha3_s fio_shake128_init(void);
```

Initializes a SHAKE128 streaming context (variable output, rate = 168 bytes).

**Returns:** an initialized `fio_sha3_s` context.

#### `fio_shake256_init`

```c
fio_sha3_s fio_shake256_init(void);
```

Initializes a SHAKE256 streaming context (variable output, rate = 136 bytes).

**Returns:** an initialized `fio_sha3_s` context.

#### `fio_shake_consume`

```c
#define fio_shake_consume fio_sha3_consume
```

Alias for `fio_sha3_consume`. Feeds data into a SHAKE streaming context.

#### `fio_shake_squeeze`

```c
void fio_shake_squeeze(fio_sha3_s *restrict h,
                       void *restrict out,
                       size_t outlen);
```

Squeezes output from a SHAKE context. Can be called multiple times to produce an arbitrary amount of output.

On the first call, applies SHAKE padding (domain separator 0x1F, then 10*1 padding) and performs the initial Keccak-f[1600] permutation. Subsequent calls continue squeezing from the Keccak state, applying additional permutations as needed.

**Parameters:**
- `h` - pointer to a SHAKE streaming context (must have been initialized with `fio_shake128_init` or `fio_shake256_init` and fed data via `fio_shake_consume`)
- `out` - destination buffer
- `outlen` - number of bytes to squeeze

**Note**: do **not** call `fio_sha3_finalize` on a SHAKE context. Use `fio_shake_squeeze` instead.

### SHA-3 Examples

#### One-Shot Hashing

```c
#define FIO_SHA3
#include FIO_INCLUDE_FILE

void example_oneshot(void) {
  const char *msg = "Hello, SHA-3!";
  uint8_t digest[32];

  fio_sha3_256(digest, msg, strlen(msg));
  /* digest[0..31] contains the SHA3-256 hash */
}
```

#### Streaming (Incremental) Hashing

```c
void example_streaming(void) {
  fio_sha3_s ctx = fio_sha3_512_init();

  /* Feed data in chunks */
  fio_sha3_consume(&ctx, "Hello, ", 7);
  fio_sha3_consume(&ctx, "SHA-3!", 6);

  uint8_t digest[64];
  fio_sha3_finalize(&ctx, digest);
  /* digest[0..63] contains the SHA3-512 hash */
}
```

#### SHAKE Extendable Output

```c
void example_shake(void) {
  const char *msg = "seed data";
  uint8_t output[1024]; /* Request 1024 bytes of output */

  /* One-shot */
  fio_shake256(output, 1024, msg, strlen(msg));

  /* Streaming with multiple squeezes */
  fio_sha3_s ctx = fio_shake128_init();
  fio_shake_consume(&ctx, msg, strlen(msg));
  
  uint8_t block1[64], block2[64];
  fio_shake_squeeze(&ctx, block1, 64); /* First 64 bytes */
  fio_shake_squeeze(&ctx, block2, 64); /* Next 64 bytes */
}
```

### SHA-3 Variant Summary

| Variant | Output | Rate | Security | Domain |
|---------|--------|------|----------|--------|
| SHA3-224 | 28 bytes | 144 bytes | 112-bit | 0x06 |
| SHA3-256 | 32 bytes | 136 bytes | 128-bit | 0x06 |
| SHA3-384 | 48 bytes | 104 bytes | 192-bit | 0x06 |
| SHA3-512 | 64 bytes | 72 bytes | 256-bit | 0x06 |
| SHAKE128 | variable | 168 bytes | 128-bit | 0x1F |
| SHAKE256 | variable | 136 bytes | 256-bit | 0x1F |

-------------------------------------------------------------------------------
